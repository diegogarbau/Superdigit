package com.ing.mb.mwchapter;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTimeoutPreemptively;

import java.time.Duration;
import java.time.temporal.ChronoUnit;
import org.junit.jupiter.api.extension.ExtendWith;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;

@ExtendWith(BenchmarkExtension.class)
public abstract class SuperDigitAbstractTest {

  private static final Duration TEST_TIMEOUT = Duration.of(500, ChronoUnit.MILLIS);
  private static final Duration LONGTEST_TIMEOUT = Duration.of(2000, ChronoUnit.MILLIS);

  public abstract SuperDigit getSut();

  @ParameterizedTest(name = "{index} number -extralong- repeated {0} times must have super-digit {2}")
  @CsvSource({
      "99999, 99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999223372036854775807, 9",
      "10000, 100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000, 1",
      "88888, 8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888, 5",
      "98765, 7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777, 2",
      "88888, 876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432187654321876543218765432, 5",
      "99999, 9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999, 9"
  })
  void extralongSuperDigits(String rep, String seed, int expected) {
    final int actual = assertTimeoutPreemptively(LONGTEST_TIMEOUT, () -> getSut().calc(seed, rep));
    assertEquals(expected, actual);
  }

  @ParameterizedTest(name = "{index} number {1} repeated {0} times must have super-digit {2}")
  @CsvSource({
      "1, 1, 1",
      "2, 1, 2",
      "1, 2, 2",
      "2, 2, 4",
      "3, 9, 9",
      "4, 10, 4",
      "5, 5, 7",
      "9, 9, 9",
      "9, 10000, 9",
      "999, 9223372036854775807, 9",
      "99, 92233720368547758079223372036854775807, 9",
      "10, 1, 1"
  })
  void extendedSuperDigits(String rep, String seed, int expected) {
    final int actual = assertTimeoutPreemptively(TEST_TIMEOUT, () -> getSut().calc(seed, rep));
    assertEquals(expected, actual);
  }

  @ParameterizedTest(name = "{index} number {1} repeated {0} times must have super-digit {2}")
  @CsvSource({
      "1, 9875, 2",
      "3, 148, 3"
  })
  void knownSuperDigits(String rep, String seed, int expected) {
    final int actual = assertTimeoutPreemptively(TEST_TIMEOUT, () -> getSut().calc(seed, rep));
    assertEquals(expected, actual);
  }
}
